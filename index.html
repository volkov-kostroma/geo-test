<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è + –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞</title>

<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>

<style>
    #map {
        width: 600px;
        height: 400px;
        margin-top: 20px;
        border: 1px solid #ccc;
    }
</style>
</head>

<body>

<h2>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏ –ø–æ–∫–∞–∑ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–µ</h2>
<button onclick="getLocation()">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>

<pre id="output"></pre>
<div id="map"></div>

<script>
let map; // –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞

function initMap(lat, lon) {
    if (!map) {
        map = new ymaps.Map("map", {
            center: [lat, lon],
            zoom: 17
        });
    } else {
        map.setCenter([lat, lon], 17);
        map.geoObjects.removeAll();
    }

    const placemark = new ymaps.Placemark([lat, lon], {
        balloonContent: "–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
    });

    map.geoObjects.add(placemark);
}

function getLocation() {
    const out = document.getElementById("output");

    if (!navigator.geolocation) {
        out.textContent = "‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.";
        return;
    }

    out.textContent = "‚è≥ –ü–æ–ª—É—á–∞—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã...";

    navigator.geolocation.getCurrentPosition(
        // –£–°–ü–ï–®–ù–û
        (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const acc = position.coords.accuracy;

            const yandexUrl = `https://yandex.ru/maps/?pt=${lon},${lat}&z=17&l=map`;

            out.innerHTML =
                "‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞!\n\n" +
                "–®–∏—Ä–æ—Ç–∞:  " + lat + "\n" +
                "–î–æ–ª–≥–æ—Ç–∞: " + lon + "\n" +
                "–¢–æ—á–Ω–æ—Å—Ç—å: " + acc + " –º\n\n" +
                "üîó <a href=\"" + yandexUrl + "\" target=\"_blank\">–û—Ç–∫—Ä—ã—Ç—å –≤ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö</a>";

            // –∂–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ API –Ø–Ω–¥–µ–∫—Å–∞ –∏ —Å—Ç—Ä–æ–∏–º –∫–∞—Ä—Ç—É
            ymaps.ready(() => initMap(lat, lon));
        },

        // –û–®–ò–ë–ö–ê
        (error) => {
            let msg = "‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ";

            switch (error.code) {
                case error.PERMISSION_DENIED:
                    msg += "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–µ—Ç–∏–ª –¥–æ—Å—Ç—É–ø.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    msg += "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.";
                    break;
                case error.TIMEOUT:
                    msg += "–¢–∞–π–º–∞—É—Ç –æ—Ç–≤–µ—Ç–∞.";
                    break;
                default:
                    msg += "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞.";
                    break;
            }

            out.textContent = msg;
        },

        // –ù–ê–°–¢–†–û–ô–ö–ò
        {
            enableHighAccuracy: true,
            timeout: 8000,
            maximumAge: 0
        }
    );
}
</script>

</body>
</html>
